$schema: https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json
name: Infinity Engine Weidu
scopeName: source.tp2.weidu

patterns:
  - include: '#comments'
  - include: '#inlined-d'
  - include: '#inlined-baf'
  - include: '#function-invocation'
  - include: '#macro-invocation'
  - include: '#function-declaration'
  - include: '#weidu-vars'
  - include: '#strings'
  - include: '#weidu-tp2-file'
  - include: '#weidu-tp2-flag'
  - include: '#weidu-tp2-language'
  - include: '#weidu-tp2-component-flag'
  - include: '#weidu-tp2-action'
  - include: '#weidu-tp2-optglob'
  - include: '#weidu-tp2-optcase'
  - include: '#weidu-tp2-optexact'
  - include: '#weidu-tp2-arrarindicessorttype'
  - include: '#weidu-tp2-patch'
  - include: '#weidu-tp2-macro'
  - include: '#weidu-tp2-patch-controls'
  - include: '#weidu-tp2-when'
  - include: '#weidu-tp2-values'
  - include: '#weidu-keywords'
  - include: '#weidu-tp2-action-flow'
  - include: '#numbers'
  - include: '#infinity-constants'
  - include: '#weidu-tp2-value-operators'
  - include: '#vars-declaration'
  - include: '#numbers'
  - include: '#weidu-vars'
  - include: '#ielib'

repository:
  comments:
    patterns:
      - match: (//).*
        name: comment.line.weidu
      - begin: /\*
        end: \*/
        name: comment.block.weidu

  weidu-tp2-file:
    name: keyword.other.weidu
    patterns:
      - match: \b(BACKUP)\b
      - match: \b(AUTHOR|SUPPORT)\b

  weidu-tp2-flag:
    name: keyword.other.weidu
    patterns:
      - match: \b(AUTO_TRA)\b
      - match: \b(ALLOW_MISSING)\b
      - match: \b(ASK_EVERY_COMPONENT)\b
      - match: \b(ALWAYS)\b
        name: keyword.control.weidu
      - match: \b(README)\b
      - match: \b(UNINSTALL_ORDER)\b
      - match: \b(MODDER)\b
      - match: \b(VERSION)\b
      - match: \b(SCRIPT_STYLE)\b
      - match: \b(NO_IF_EVAL_BUG)\b
      - match: \b(QUICK_MENU)\b
      - match: \b(AUTO_EVAL_STRINGS)\b

  weidu-tp2-language:
    name: keyword.other.weidu
    patterns:
      - match: \b(LANGUAGE)\b

  weidu-tp2-component-flag:
    name: keyword.other.weidu
    patterns:
      - match: \b(DEPRECATED)\b
      - match: \b(REQUIRE_COMPONENT)\b
      - match: \b(FORBID_COMPONENT)\b
      - match: \b(REQUIRE_PREDICATE)\b
      - match: \b(SUBCOMPONENT)\b
      - match: \b(FORCED_SUBCOMPONENT)\b
      - match: \b(GROUP)\b
      - match: \b(INSTALL_BY_DEFAULT)\b
      - match: \b(DESIGNATED)\b
      - match: \b(NO_LOG_RECORD)\b
      - match: \b(LABEL)\b

  weidu-tp2-action:
    name: support.function.weidu
    patterns:
      - match: \b(COPY)\b
      - match: \b(COPY_EXISTING)\b
      - match: \b(COPY_EXISTING_REGEXP)\b
      - match: \b(COPY_LARGE)\b
      - match: \b(COPY_RANDOM)\b
      - match: \b(COPY_ALL_GAM_FILES)\b
      - match: \b(MOVE)\b
      - match: \b(DELETE)\b
      - match: \b(DISABLE_FROM_KEY)\b
      - match: \b(CREATE)\b
      - match: \b(COMPILE)\b
      - match: \b(CLEAR_MEMORY)\b
      - match: \b(CLEAR_ARRAYS)\b
      - match: \b(CLEAR_CODES)\b
      - match: \b(CLEAR_INLINED)\b
      - match: \b(CLEAR_EVERYTHING)\b
      - match: \b(CLEAR_IDS_MAP)\b
      - match: \b(ACTION_CLEAR_ARRAY)\b
      - match: \b(SILENT)\b
      - match: \b(VERBOSE)\b
      - match: \b(MKDIR)\b
      - match: \b(RANDOM_SEED)\b
      - match: \b(ACTION_READLN)\b
      - match: \b(APPEND)\b
      - match: \b(APPEND_OUTER)\b
      - match: \b(APPEND_COL)\b
      - match: \b(APPEND_COL_OUTER)\b
      - match: \b(EXTEND_TOP)\b
      - match: \b(EXTEND_BOTTOM)\b
      - match: \b(EXTEND_TOP_REGEXP)\b
      - match: \b(EXTEND_BOTTOM_REGEXP)\b
      - match: \b(MAKE_BIFF)\b
      - match: \b(LOAD_TRA)\b
      - match: \b(WITH_TRA)\b
      - match: \b(WITH_SCOPE)\b
      - match: \b(UNINSTALL)\b
      - match: \b(COPY_KIT)\b
      - match: \b(ADD_KIT)\b
      - match: \b(ADD_MUSIC)\b
      - match: \b(ADD_SCHOOL)\b
      - match: \b(ADD_SECTYPE)\b
      - match: \b(ADD_AREA_TYPE)\b
      - match: \b(ADD_PROJECTILE)\b
      - match: \b(ADD_SPELL)\b
      - match: \b(ADD_JOURNAL)\b
      - match: \b(STRING_SET)\b
      - match: \b(STRING_SET_EVALUATE)\b
      - match: \b(STRING_SET_RANGE)\b
      - match: \b(ALTER_TLK_RANGE)\b
      - match: \b(ALTER_TLK_LIST)\b
      - match: \b(ALTER_TLK)\b
      - match: \b(REQUIRE_FILE)\b
      - match: \b(FORBID_FILE)\b
      - match: \b(FAIL)\b
      - match: \b(ABORT)\b
      - match: \b(WARN)\b
      - match: \b(PRINT)\b
      - match: \b(LOG)\b
      - match: \b(OUTER_TEXT_SPRINT)\b
      - match: \b(OUTER_SPRINT)\b
      - match: \b(OUTER_SNPRINT)\b
      - match: \b(OUTER_SET)\b
      - match: \b(OUTER_INNER_PATCH)\b
      - match: \b(OUTER_PATCH)\b
      - match: \b(OUTER_INNER_PATCH_SAVE)\b
      - match: \b(OUTER_PATCH_SAVE)\b
      - match: \b(OUTER_WHILE)\b
      - match: \b(OUTER_FOR)\b
      - match: \b(ACTION_BASH_FOR)\b
      - match: \b(ACTION_DEFINE_ARRAY)\b
      - match: \b(ACTION_SORT_ARRAY_INDICES)\b
      - match: \b(GET_FILE_ARRAY)\b
      - match: \b(GET_DIRECTORY_ARRAY)\b
      - match: \b(ACTION_DEFINE_ASSOCIATIVE_ARRAY)\b
      - match: \b(ACTION_TO_UPPER)\b
      - match: \b(ACTION_TO_LOWER)\b
      - match: \b(ACTION_GET_STRREF)\b
      - match: \b(ACTION_GET_STRREF_F)\b
      - match: \b(ACTION_GET_STRREF_S)\b
      - match: \b(ACTION_GET_STRREF_FS)\b
      - match: \b(DECOMPRESS_BIFF)\b
      - match: \b(DEFINE_ACTION_MACRO)\b
      - match: \b(DEFINE_PATCH_MACRO)\b
      - match: \b(DEFINE_ACTION_FUNCTION)\b
      - match: \b(DEFINE_PATCH_FUNCTION)\b
      - match: \b(ACTION_TIME)\b

  weidu-tp2-action-flow:
    name: keyword.control.action.weidu
    patterns:
      - match: \b(ACTION_IF)\b
      - match: \b(ACTION_MATCH)\b
      - match: \b(ACTION_TRY)\b
      - match: \b(ACTION_RERAISE)\b
      - match: \b(AT_EXIT)\b
      - match: \b(AT_INTERACTIVE_EXIT)\b
      - match: \b(AT_UNINSTALL)\b
      - match: \b(AT_INTERACTIVE_UNINSTALL)\b
      - match: \b(AT_UNINSTALL_EXIT)\b
      - match: \b(AT_INTERACTIVE_UNINSTALL_EXIT)\b
      - match: \b(AT_NOW)\b
      - match: \b(AT_INTERACTIVE_NOW)\b
      - match: \b(ACTION_FOR_EACH)\b
      - match: \b(ACTION_PHP_EACH)\b
      - match: \b(INCLUDE)\b
      - match: \b(ACTION_INCLUDE)\b
      - match: \b(REINCLUDE)\b
      - match: \b(ACTION_REINCLUDE)\b
      - match: \b(USING)\b
      - match: \b(AS)\b

  weidu-tp2-optglob:
    name: constant.language.flag.weidu
    patterns:
      - match: \b(GLOB)\b
      - match: \b(NOGLOB)\b

  weidu-tp2-optcase:
    name: constant.language.flag.weidu
    patterns:
      - match: \b(CASE_SENSITIVE)\b
      - match: \b(CASE_INSENSITIVE)\b

  weidu-tp2-optexact:
    name: constant.language.flag.weidu
    patterns:
      - match: \b(EXACT_MATCH)\b
      - match: \b(EVALUATE_REGEXP)\b

  weidu-tp2-arrarindicessorttype:
    name: constant.language.flag.weidu
    patterns:
      - match: \b(LEXICOGRAPHICALLY)\b
      - match: \b(NUMERICALLY)\b

  weidu-tp2-patch:
    name: support.function.tp2.weidu
    patterns:
      - match: \b(SAY)\b
      - match: \b(PATCH_FAIL)\b
      - match: \b(PATCH_ABORT)\b
      - match: \b(PATCH_WARN)\b
      - match: \b(PATCH_PRINT)\b
      - match: \b(PATCH_LOG)\b
      - match: \b(SAY_EVALUATED)\b
      - match: \b(TO_UPPER)\b
      - match: \b(TO_LOWER)\b
      - match: \b(TEXT_SPRINT)\b
      - match: \b(SPRINT)\b
      - match: \b(SNPRINT)\b
      - match: \b(SPRINTF)\b
      - match: \b(SOURCE_BIFF)\b
      - match: \b(SPACES)\b
      - match: \b(QUOTE)\b
      - match: \b(REPLACE)\b
      - match: \b(REPLACE_TEXTUALLY)\b
      - match: \b(EVALUATE_BUFFER_SPECIAL)\b
      - match: \b(EVALUATE_BUFFER)\b
      - match: \b(EVAL)\b
      - match: \b(APPLY_BCS_PATCH)\b
      - match: \b(APPLY_BCS_PATCH_OR_COPY)\b
      - match: \b(WRITE_BYTE)\b
      - match: \b(WRITE_SHORT)\b
      - match: \b(WRITE_LONG)\b
      - match: \b(WRITE_ASCII)\b
      - match: \b(WRITE_ASCII_LIST)\b
      - match: \b(WRITE_ASCII_TERMINATE)\b
      - match: \b(WRITE_ASCIIT)\b
      - match: \b(WRITE_EVALUATED_ASCII)\b
      - match: \b(WRITE_ASCIIE)\b
      - match: \b(WRITE_FILE)\b
      - match: \b(INSERT_FILE)\b
      - match: \b(APPEND_FILE)\b
      - match: \b(APPEND_FILE_EVALUATE)\b
      - match: \b(REPLACE_BCS_BLOCK)\b
      - match: \b(INSERT_BYTES)\b
      - match: \b(DELETE_BYTES)\b
      - match: \b(READ_BYTE)\b
      - match: \b(READ_SBYTE)\b
      - match: \b(READ_SHORT)\b
      - match: \b(READ_SSHORT)\b
      - match: \b(READ_LONG)\b
      - match: \b(READ_SLONG)\b
      - match: \b(READ_ASCII)\b
      - match: \b(READ_STRREF)\b
      - match: \b(READ_STRREF_F)\b
      - match: \b(READ_STRREF_S)\b
      - match: \b(READ_STRREF_FS)\b
      - match: \b(GET_OFFSET_ARRAY)\b
      - match: \b(GET_OFFSET_ARRAY2)\b
      - match: \b(DEFINE_ASSOCIATIVE_ARRAY)\b
      - match: \b(GET_STRREF)\b
      - match: \b(GET_STRREF_F)\b
      - match: \b(GET_STRREF_S)\b
      - match: \b(GET_STRREF_FS)\b
      - match: \b(DEFINE_ARRAY)\b
      - match: \b(PATCH_DEFINE_ARRAY)\b
      - match: \b(SORT_ARRAY_INDICES)\b
      - match: \b(CLEAR_ARRAY)\b
      - match: \b(PATCH_CLEAR_ARRAY)\b
      - match: \b(PATCH_RERAISE)\b
      - match: \b(PATCH_INCLUDE)\b
      - match: \b(PATCH_REINCLUDE)\b
      - match: \b(PATCH_WITH_TRA)\b
      - match: \b(PATCH_WITH_SCOPE)\b
      - match: \b(SET_2DA_ENTRY)\b
      - match: \b(SET_2DA_ENTRY_LATER)\b
      - match: \b(SET_2DA_ENTRIES_NOW)\b
      - match: \b(PRETTY_PRINT_2DA)\b
      - match: \b(INSERT_2DA_ROW)\b
      - match: \b(REMOVE_2DA_ROW)\b
      - match: \b(PATCH_READLN)\b
      - match: \b(PATCH_RANDOM_SEED)\b
      - match: \b(ADD_STORE_ITEM)\b
      - match: \b(REMOVE_STORE_ITEM)\b
      - match: \b(READ_2DA_ENTRY)\b
      - match: \b(READ_2DA_ENTRIES_NOW)\b
      - match: \b(READ_2DA_ENTRY_FORMER)\b
      - match: \b(COUNT_2DA_ROWS)\b
      - match: \b(COUNT_2DA_COLS)\b
      - match: \b(COUNT_REGEXP_INSTANCES)\b
      - match: \b(LOOKUP_IDS_SYMBOL_OF_INT)\b
      - match: \b(COMPILE_BAF_TO_BCS)\b
      - match: \b(DECOMPILE_BCS_TO_BAF)\b
      - match: \b(DECOMPILE_DLG_TO_D)\b
      - match: \b(COMPILE_D_TO_DLG)\b
      - match: \b(DECOMPILE_AND_PATCH)\b
      - match: \b(REFACTOR_TRIGGER)\b
      - match: \b(REFACTOR_BAF_TRIGGER)\b
      - match: \b(REFACTOR_D_TRIGGER)\b
      - match: \b(REPLACE_EVALUATE)\b
      - match: \b(ADD_GAM_NPC)\b
      - match: \b(ADD_MAP_NOTE)\b
      - match: \b(ADD_KNOWN_SPELL)\b
      - match: \b(ADD_MEMORIZED_SPELL)\b
      - match: \b(REMOVE_KNOWN_SPELL)\b
      - match: \b(REMOVE_MEMORIZED_SPELL)\b
      - match: \b(SET_BG2_PROFICIENCY)\b
      - match: \b(ADD_CRE_ITEM)\b
      - match: \b(REPLACE_CRE_ITEM)\b
      - match: \b(REMOVE_CRE_ITEM)\b
      - match: \b(REMOVE_CRE_ITEMS)\b
      - match: \b(REMOVE_CRE_EFFECTS)\b
      - match: \b(REMOVE_KNOWN_SPELLS)\b
      - match: \b(REMOVE_MEMORIZED_SPELLS)\b
      - match: \b(PATCH_SILENT)\b
      - match: \b(EDIT_SAV_FILE)\b
      - match: \b(DECOMPRESS_REPLACE_FILE)\b
      - match: \b(DECOMPRESS_INTO_FILE)\b
      - match: \b(DECOMPRESS_INTO_VAR)\b
      - match: \b(COMPRESS_REPLACE_FILE)\b
      - match: \b(COMPRESS_INTO_FILE)\b
      - match: \b(COMPRESS_INTO_VAR)\b

  weidu-tp2-macro:
    name: support.function.tp2.weidu
    patterns:
      - match: \b(ADD_ITEM_EQEFFECT)\b
      - match: \b(ADD_ITEM_EFFECT)\b
      - match: \b(ALTER_ITEM_EFFECT)\b
      - match: \b(ALTER_ITEM_HEADER)\b
      - match: \b(DELETE_ITEM_HEADER)\b
      - match: \b(DELETE_ITEM_EFFECT)\b
      - match: \b(DELETE_ITEM_EQEFFECT)\b
      - match: \b(ADD_SPELL_CFEFFECT)\b
      - match: \b(ADD_SPELL_EFFECT)\b
      - match: \b(ALTER_SPELL_EFFECT)\b
      - match: \b(ALTER_SPELL_HEADER)\b
      - match: \b(DELETE_SPELL_EFFECT)\b
      - match: \b(DELETE_SPELL_HEADER)\b
      - match: \b(DELETE_EFFECT)\b
      - match: \b(ALTER_EFFECT)\b
      - match: \b(CLONE_EFFECT)\b
      - match: \b(DELETE_CRE_EFFECT)\b
      - match: \b(ADD_CRE_EFFECT)\b
      - match: \b(ITEM_EFFECT_TO_SPELL)\b
      - match: \b(RES_NUM_OF_SPELL_NAME)\b
      - match: \b(RES_NAME_OF_SPELL_NUM)\b
      - match: \b(NAME_NUM_OF_SPELL_RES)\b
      - match: \b(GET_UNIQUE_FILE_NAME)\b
      - match: \b(ALTER_AREA_DOOR)\b
      - match: \b(REPLACE_STORE_ITEM)\b
      - match: \b(REPLACE_AREA_ITEM)\b
      - match: \b(ADD_AREA_ITEM)\b
      - match: \b(ADD_AREA_REGION_TRIGGER)\b
      - match: \b(ALTER_AREA_ACTOR)\b
      - match: \b(ALTER_AREA_REGION)\b
      - match: \b(ALTER_AREA_CONTAINER)\b
      - match: \b(ADD_CRE_ITEM_FLAGS)\b
      - match: \b(REMOVE_CRE_ITEM_FLAGS)\b
      - match: \b(SET_CRE_ITEM_FLAGS)\b
      - match: \b(ALTER_AREA_ENTRANCE)\b
      - match: \b(WRITE_SOUNDSET)\b
      - match: \b(READ_SOUNDSET)\b
      - match: \b(tb#factorial)\b
      - match: \b(tb#fix_file_size)\b
      - match: \b(FJ_CRE_VALIDITY)\b
      - match: \b(FJ_CRE_REINDEX)\b
      - match: \b(FJ_CRE_EFF_V2)\b
      - match: \b(T-CRE_EFF_V1)\b
      - match: \b(SUBSTRING)\b
      - match: \b(ADD_CRE_SCRIPT)\b
      - match: \b(DELETE_WORLDMAP_LINKS)\b
      - match: \b(ADD_WORLDMAP_LINKS)\b
      - match: \b(UPDATE_PVRZ_INDICES)\b
      - match: \b(INSTALL_PVRZ)\b
      - match: \b(FIND_FREE_PVRZ_INDEX)\b
      - match: \b(DIRECTORY_OF_FILESPEC)\b
      - match: \b(FILE_OF_FILESPEC)\b
      - match: \b(RES_OF_FILESPEC)\b
      - match: \b(EXT_OF_FILESPEC)\b
      - match: \b(fj_are_structure)\b
      - match: \b(sc#addWmpAre)\b
      - match: \b(HANDLE_AUDIO)\b
      - match: \b(HANDLE_TILESETS)\b
      - match: \b(HANDLE_CHARSETS)\b

  weidu-tp2-patch-controls:
    name: keyword.control.patch.weidu
    patterns:
      - match: \b(SET)\b
      - match: \b(WHILE)\b
      - match: \b(FOR)\b
      - match: \b(PATCH_BASH_FOR)\b
      - match: \b(PATCH_FOR_EACH)\b
      - match: \b(PHP_EACH)\b
      - match: \b(PATCH_PHP_EACH)\b
      - match: \b(PATCH_IF)\b
      - match: \b(ELSE)\b
      - match: \b(PATCH_MATCH)\b
      - match: \b(PATCH_TRY)\b
      - match: \b(PATCH_SILENT)\b
      - match: \b(PATCH_VERBOSE)\b
      - match: \b(INNER_PATCH)\b
      - match: \b(INNER_PATCH_SAVE)\b
      - match: \b(INNER_PATCH_FILE)\b
      - match: \b(INNER_ACTION)\b
      - match: \b(PATCH_TIME)\b

  weidu-tp2-when:
    name: keyword.control.when.weidu
    patterns:
      - match: \b(IF_SIZE_IS)\b
      - match: \b(I_S_I)\b
      - match: \b(IF)\b
      - match: \b(UNLESS)\b
      - match: \b(BUT_ONLY_IF_IT_CHANGES)\b
      - match: \b(BUT_ONLY)\b
      - match: \b(IF_EXISTS)\b

  weidu-tp2-value-operators:
    name: keyword.control.value.weidu
    patterns:
      - match: (\=\>|\+|-|\*|\/|=|\*|!|>|<|\?|:)
      - match: \b(MODULO|NOT|OR|AND|BAND|BOR|BXOR|BNOT|BLSL|BASR)\b

  weidu-tp2-values:
    name: support.function.tp2value.weidu
    patterns:
      - match: \b(BYTE_AT)\b
      - match: \b(SBYTE_AT)\b
      - match: \b(SHORT_AT)\b
      - match: \b(SSHORT_AT)\b
      - match: \b(LONG_AT)\b
      - match: \b(SLONG_AT)\b
      - match: \b(STRING_COMPARE)\b
      - match: \b(STRING_COMPARE_CASE)\b
      - match: \b(STRING_EQUAL)\b
      - match: \b(STRING_EQUAL_CASE)\b
      - match: \b(STR_EQ)\b
      - match: \b(STRING_MATCHES_REGEXP)\b
      - match: \b(STRING_CONTAINS_REGEXP)\b
      - match: \b(GAME_IS)\b
      - match: \b(ENGINE_IS)\b
      - match: \b(GAME_INCLUDES)\b
      - match: \b(IDS_OF_SYMBOL)\b
      - match: \b(VARIABLE_IS_SET)\b
      - match: \b(IS_AN_INT)\b
      - match: \b(TRA_ENTRY_EXISTS)\b
      - match: \b(IS_SILENT)\b
      - match: \b(MOD_IS_INSTALLED)\b
      - match: \b(INSTALL_ORDER)\b
      - match: \b(ID_OF_LABEL)\b
      - match: \b(STATE_WHICH_SAYS)\b
      - match: \b(RESOLVE_STR_REF)\b
      - match: \b(NEXT_STRREF)\b
      - match: \b(RANDOM)\b
      - match: \b(BUFFER_LENGTH)\b
      - match: \b(INDEX)\b
      - match: \b(RINDEX)\b
      - match: \b(INDEX_BUFFER)\b
      - match: \b(RINDEX_BUFFER)\b
      - match: \b(STRING_LENGTH)\b
      - match: \b(FILE_CONTAINS)\b
      - match: \b(FILE_CONTAINS_EVALUATED)\b
      - match: \b(FILE_EXISTS)\b
      - match: \b(DIRECTORY_EXISTS)\b
      - match: \b(FILE_EXISTS_IN_GAME)\b
      - match: \b(FILE_MD5)\b
      - match: \b(FILE_IS_IN_COMPRESSED_BIFF)\b
      - match: \b(BIFF_IS_COMPRESSED)\b
      - match: \b(FILE_SIZE)\b
      - match: \b(SIZE_OF_FILE)\b
      - match: \b(VALID_SCRIPT_ACTIONS)\b
      - match: \b(VALID_SCRIPT_TRIGGERS)\b
      - match: \b(EVALUATE_BUFFER)\b
      - match: \b(WEIDU_ARCH)\b
      - match: \b(WEIDU_OS)\b
      - match: \b(COMPONENT_NUMBER)\b
      - match: \b(INTERACTIVE)\b

  weidu-keywords:
    name: keyword.control.weidu
    patterns:
      - match: \b(BEGIN|END|THEN|IN|ELSE)\b
      - match: \b(AFTER|BEFORE|LAST|FIRST|AT|THIS)\b
      - match: \b(INT_VAR|STR_VAR|RET|RET_ARRAY)\b

  strings:
    patterns:
      - name: string.quoted.double.weidu
        begin: '"'
        end: '"'
        patterns:
          - include: '#non-weidu-vars'
      - name: string.quoted.5tildes.weidu
        begin: ~~~~~
        end: ~~~~~
        patterns:
          - include: '#non-weidu-vars'
      - match: \s(@)([0-9]+)\s
        captures:
          '1':
            name: variable.parameter.tra.weidu
          '2':
            name: variable.parameter.tra.weidu

      - name: string.quoted.tilde.weidu
        begin: '~'
        end: '~'
        patterns:
          - include: '#non-weidu-vars'

  weidu-vars:
    name: constant.language.weidu
    patterns:
      - match: (%?TP2_AUTHOR%?)
      - match: (%?TP2_FILE_NAME%?)
      - match: (%?MOD_FOLDER%?)
      - match: (%LANGUAGE%)
      - match: (%?SOURCE_DIRECTORY%?)
      - match: (%?SOURCE_FILESPEC%?)
      - match: (%?SOURCE_FILE%?)
      - match: (%?SOURCE_RES%?)
      - match: (%?SOURCE_EXT%?)
      - match: (%?DEST_DIRECTORY%?)
      - match: (%?DEST_FILESPEC%?)
      - match: (%?DEST_FILE%?)
      - match: (%?DEST_RES%?)
      - match: (%?DEST_EXT%?)
      - match: (%?SOURCE_SIZE%?)

      - match: (%?BASH_FOR_DIRECTORY%?)
      - match: (%?BASH_FOR_FILESPEC%?)
      - match: (%?BASH_FOR_FILE%?)
      - match: (%?BASH_FOR_RES%?)
      - match: (%?BASH_FOR_EXT%?)
      - match: (%?BASH_FOR_SIZE%?)

      - match: (%?ARE_V10_ACTORS%?)
      - match: (%?ARE_V10_REGIONS%?)
      - match: (%?ARE_V10_SPAWN_POINTS%?)
      - match: (%?ARE_V10_ENTRANCES%?)
      - match: (%?ARE_V10_CONTAINERS%?)
      - match: (%?ARE_V10_AMBIENTS%?)
      - match: (%?ARE_V10_DOORS%?)
      - match: (%?ARE_V10_ANIMATIONS%?)
      - match: (%?ARE_V91_ACTORS%?)
      - match: (%?CRE_V10_KNOWN_SPELLS%?)
      - match: (%?CRE_V10_SPELL_MEM_INFO%?)
      - match: (%?CRE_V10_EFFECTS%?)
      - match: (%?CRE_V10_ITEMS%?)
      - match: (%?ITM_V10_HEADERS%?)
      - match: (%?ITM_V10_GEN_EFFECTS%?)
      - match: (%?SPL_V10_HEADERS%?)
      - match: (%?SPL_V10_GEN_EFFECTS%?)
      - match: (%?STO_V10_ITEMS_PURCHASED%?)
      - match: (%?STO_V10_ITEMS_SOLD%?)
      - match: (%?STO_V10_DRINKS%?)
      - match: (%?STO_V10_CURES%?)
      - match: (%?WMP_AREAS%?)
      - match: (%?WMP_LINKS%?)

      - match: (%?ARE_V10_ITEMS%?)
      - match: (%?ARE_V10_REGION_VERTICES%?)
      - match: (%?ARE_V10_CONTAINER_VERTICES%?)
      - match: (%?ARE_V10_DOOR_OPEN_OUTLINE_VERTICES%?)
      - match: (%?ARE_V10_DOOR_CLOSED_OUTLINE_VERTICES%?)
      - match: (%?ARE_V10_DOOR_OPEN_CELL_VERTICES%?)
      - match: (%?ARE_V10_DOOR_CLOSED_CELL_VERTICES%?)
      - match: (%?CRE_V10_SPELL_MEM%?)
      - match: (%?ITM_V10_HEAD_EFFECTS%?)
      - match: (%?SPL_V10_HEAD_EFFECTS%?)
      - match: (%?WMP_NORTH_LINKS%?)
      - match: (%?WMP_WEST_LINKS%?)
      - match: (%?WMP_SOUTH_LINKS%?)
      - match: (%?WMP_EAST_LINKS%?)

  non-weidu-vars:
    name: variable.parameter.weidu
    patterns:
      - include: '#weidu-vars'
      - match: (%)((\w*)(%\w+%)(\w*))(%)
        captures:
          '1':
            name: keyword.control.double-eval.weidu
          '3':
            name: keyword.control.double-eval.weidu
          '5':
            name: keyword.control.double-eval.weidu
          '6':
            name: keyword.control.double-eval.weidu
      - match: (%\w+%)

  numbers:
    patterns:
      - match: \b(([0-9]+)|(0x[0-9a-fA-F]+)|(0b[0-1]+))\b
        name: constant.numeric.weidu
      - match: \s(#?[0-9]+)\b
        name: constant.numeric.weidu

  macro-invocation:
    name: meta.macro.invocation.weidu
    begin: \b(LAM|LAUNCH_ACTION_MACRO|LPM|LAUNCH_PATCH_MACRO)\b
    end: ((\w+)|(\S+))
    beginCaptures:
      '1':
        name: keyword.control.weidu
    endCaptures:
      '2':
        name: entity.name.function
      '3':
        name: name.function.weidu
        patterns:
          - include: '#strings'

  function-invocation:
    name: meta.function.invocation.weidu
    begin: \b(LAF|LAUNCH_ACTION_FUNCTION|LPF|LAUNCH_PATCH_FUNCTION)\b
    end: ((\w+)|(\S+))
    beginCaptures:
      '1':
        name: keyword.control.weidu
    endCaptures:
      '2':
        name: entity.name.function
      '3':
        name: name.function.weidu
        patterns:
          - include: '#strings'

  function-declaration:
    name: meta.function.declaration.weidu
    begin: \b(DEFINE_ACTION_FUNCTION|DEFINE_PATCH_FUNCTION)\s+(~)?(\w+)(~)?
    end: \b(BEGIN)\b
    beginCaptures:
      '1':
        name: keyword.control.weidu
      '2':
        name: keyword.control.weidu
      '3':
        name: entity.name.function
      '4':
        name: keyword.control.weidu
    endCaptures:
      '1':
        name: keyword.control.weidu
    patterns:
      - match: \b(STR_VAR|INT_VAR|RET|RET_ARRAY)\b
        name: keyword.control.weidu
      - include: '#vars-declaration'
      - include: '#comments'
      - include: '#numbers'
      - include: '#strings'


  vars-declaration:
    name: variable.complex.weidu
    patterns:
      - match: \b([\w]+)\s*(=)\s*(EVAL\s+)?
        captures:
          '1':
            name: variable.parameter.weidu
          '2':
            name: keyword.control.weidu
          '3':
            name: support.function.tp2.weidu

  infinity-constants:
    name: constant.language.infinity.weidu
    patterns:
      - match: \b(NAME1)\b
      - match: \b(NAME2)\b
      - match: \b(DESC)\b
      - match: \b(UNIDENTIFIED_DESC)\b

      - match: \b(AREA_CITY)\b
      - match: \b(AREA_DAY)\b
      - match: \b(AREA_DUNGEON)\b
      - match: \b(AREA_FOREST)\b
      - match: \b(AREA_NIGHT)\b
      - match: \b(ATTACK1)\b
      - match: \b(ATTACK2)\b
      - match: \b(ATTACK3)\b
      - match: \b(ATTACK4)\b
      - match: \b(ATTACK)\b
      - match: \b(BATTLE_CRY1)\b
      - match: \b(BATTLE_CRY2)\b
      - match: \b(BATTLE_CRY3)\b
      - match: \b(BATTLE_CRY4)\b
      - match: \b(BATTLE_CRY5)\b
      - match: \b(BATTLE_CRY)\b
      - match: \b(BIO)\b
      - match: \b(BORED)\b
      - match: \b(COMPLIMENT1)\b
      - match: \b(COMPLIMENT2)\b
      - match: \b(COMPLIMENT3)\b
      - match: \b(COMPLIMENT)\b
      - match: \b(CRITICAL_HIT)\b
      - match: \b(CRITICAL_MISS)\b
      - match: \b(DAMAGE)\b
      - match: \b(DIALOG_DEFAULT)\b
      - match: \b(DIALOG_HOSTILE)\b
      - match: \b(DYING)\b
      - match: \b(EXISTANCE1)\b
      - match: \b(EXISTANCE2)\b
      - match: \b(EXISTANCE3)\b
      - match: \b(EXISTANCE4)\b
      - match: \b(EXISTANCE5)\b
      - match: \b(HAPPY)\b
      - match: \b(HIDDEN_IN_SHADOWS)\b
      - match: \b(HURT)\b
      - match: \b(INITIAL_MEETING)\b
      - match: \b(INSULT1)\b
      - match: \b(INSULT2)\b
      - match: \b(INSULT3)\b
      - match: \b(INSULT)\b
      - match: \b(INTERACTION1)\b
      - match: \b(INTERACTION2)\b
      - match: \b(INTERACTION3)\b
      - match: \b(INTERACTION4)\b
      - match: \b(INTERACTION5)\b
      - match: \b(INTERACTION)\b
      - match: \b(INVENTORY_FULL)\b
      - match: \b(LEADER)\b
      - match: \b(MISCELLANEOUS)\b
      - match: \b(MORALE)\b
      - match: \b(PICKED_POCKET)\b
      - match: \b(REACT_TO_DIE_GENERAL)\b
      - match: \b(REACT_TO_DIE_SPECIFIC)\b
      - match: \b(RESPONSE_TO_COMPLIMENT1)\b
      - match: \b(RESPONSE_TO_COMPLIMENT2)\b
      - match: \b(RESPONSE_TO_COMPLIMENT3)\b
      - match: \b(RESPONSE_TO_COMPLIMENT)\b
      - match: \b(RESPONSE_TO_INSULT1)\b
      - match: \b(RESPONSE_TO_INSULT2)\b
      - match: \b(RESPONSE_TO_INSULT3)\b
      - match: \b(RESPONSE_TO_INSULT)\b
      - match: \b(SELECT_ACTION1)\b
      - match: \b(SELECT_ACTION2)\b
      - match: \b(SELECT_ACTION3)\b
      - match: \b(SELECT_ACTION4)\b
      - match: \b(SELECT_ACTION5)\b
      - match: \b(SELECT_ACTION6)\b
      - match: \b(SELECT_ACTION7)\b
      - match: \b(SELECT_ACTION)\b
      - match: \b(SELECT_COMMON1)\b
      - match: \b(SELECT_COMMON2)\b
      - match: \b(SELECT_COMMON3)\b
      - match: \b(SELECT_COMMON4)\b
      - match: \b(SELECT_COMMON5)\b
      - match: \b(SELECT_COMMON6)\b
      - match: \b(SELECT_COMMON)\b
      - match: \b(SELECT_RARE1)\b
      - match: \b(SELECT_RARE2)\b
      - match: \b(SELECT_RARE)\b
      - match: \b(SET_A_TRAP)\b
      - match: \b(SPECIAL1)\b
      - match: \b(SPECIAL2)\b
      - match: \b(SPECIAL3)\b
      - match: \b(SPECIAL)\b
      - match: \b(SPELL_DISRUPTED)\b
      - match: \b(TARGET_IMMUNE)\b
      - match: \b(TIRED)\b
      - match: \b(UNHAPPY_ANNOYED)\b
      - match: \b(UNHAPPY_BREAKING)\b
      - match: \b(UNHAPPY_SERIOUS)\b
      - match: \b(STORE_NAME)\b

      - match: \b(SCRIPT_OVERRIDE)\b
      - match: \b(SCRIPT_CLASS)\b
      - match: \b(SCRIPT_RACE)\b
      - match: \b(SCRIPT_GENERAL)\b
      - match: \b(SCRIPT_DEFAULT)\b
      - match: \b(DEATHVAR)\b
      - match: \b(DIALOG)\b
      - match: \b(AREA_SCRIPT)\b

      - match: \b(BIT0)\b
      - match: \b(BIT1)\b
      - match: \b(BIT2)\b
      - match: \b(BIT3)\b
      - match: \b(BIT4)\b
      - match: \b(BIT5)\b
      - match: \b(BIT6)\b
      - match: \b(BIT7)\b
      - match: \b(BIT8)\b
      - match: \b(BIT9)\b
      - match: \b(BIT10)\b
      - match: \b(BIT11)\b
      - match: \b(BIT12)\b
      - match: \b(BIT13)\b
      - match: \b(BIT14)\b
      - match: \b(BIT15)\b
      - match: \b(BIT16)\b
      - match: \b(BIT17)\b
      - match: \b(BIT18)\b
      - match: \b(BIT19)\b
      - match: \b(BIT20)\b
      - match: \b(BIT21)\b
      - match: \b(BIT22)\b
      - match: \b(BIT23)\b
      - match: \b(BIT24)\b
      - match: \b(BIT25)\b
      - match: \b(BIT26)\b
      - match: \b(BIT27)\b
      - match: \b(BIT28)\b
      - match: \b(BIT29)\b
      - match: \b(BIT30)\b
      - match: \b(BIT31)\b

      - match: \b(WNL)\b
      - match: \b(MNL)\b
      - match: \b(LNL)\b
      - match: \b(TAB)\b

      - match: \b(REGISTRY_BG1_PATH)\b
      - match: \b(REGISTRY_BG2_PATH)\b
      - match: \b(REGISTRY_PST_PATH)\b
      - match: \b(REGISTRY_IWD1_PATH)\b
      - match: \b(REGISTRY_IWD2_PATH)\b

      - match: \b(USER_DIRECTORY)\b
      - match: \b(SAVE_DIRECTORY)\b
      - match: \b(MPSAVE_DIRECTORY)\b
      - match: \b(EE_LANGUAGE)\b

  inlined-d:
    name: meta.weidu.inlined.d
    begin: (<<<<<<<<)\s+(\S+\.d)\b
    beginCaptures:
      '1':
        name: keyword.other.weidu
      '2':
        name: variable.language.inlined-file.weidu
    end: (>>>>>>>>)
    endCaptures:
      '1':
        name: keyword.other.weidu
    patterns:
      - include: source.d.weidu

  inlined-baf:
    name: meta.weidu.inlined.baf
    begin: (<<<<<<<<)\s+(\S+\.baf)\b
    beginCaptures:
      '1':
        name: keyword.other.weidu
      '2':
        name: variable.language.inlined-file.weidu
    end: (>>>>>>>>)
    endCaptures:
      '1':
        name: keyword.other.weidu
    patterns:
      - include: source.baf.weidu

  ielib:
    name: constant.language.ielib.weidu
    patterns:
      - match: \b(DISPEL_no_BYPASS_MR_yes)\b
      - match: \b(DISPEL_yes_BYPASS_MR_no)\b
      - match: \b(DISPEL_yes_BYPASS_MR_yes)\b
      - match: \b(ICON_ability_score_drained)\b
      - match: \b(ICON_able_to_poison_weapons)\b
      - match: \b(ICON_absolute_immunity)\b
      - match: \b(ICON_acid)\b
      - match: \b(ICON_aid)\b
      - match: \b(ICON_animal_rage)\b
      - match: \b(ICON_assassination)\b
      - match: \b(ICON_at_a_store)\b
      - match: \b(ICON_aura_of_flaming_death)\b
      - match: \b(ICON_avoid_death)\b
      - match: \b(ICON_bad_luck)\b
      - match: \b(ICON_barbarian_rage)\b
      - match: \b(ICON_bard_song)\b
      - match: \b(ICON_barkskin)\b
      - match: \b(ICON_berserk)\b
      - match: \b(ICON_blade_barrier)\b
      - match: \b(ICON_bleeding)\b
      - match: \b(ICON_blessed)\b
      - match: \b(ICON_blind)\b
      - match: \b(ICON_blood_rage)\b
      - match: \b(ICON_boon_of_lathander)\b
      - match: \b(ICON_called_shot)\b
      - match: \b(ICON_cats_grace)\b
      - match: \b(ICON_champions_strength)\b
      - match: \b(ICON_chant)\b
      - match: \b(ICON_chaos)\b
      - match: \b(ICON_chaos_of_battle)\b
      - match: \b(ICON_chaos_shield)\b
      - match: \b(ICON_chaotic_commands)\b
      - match: \b(ICON_charm)\b
      - match: \b(ICON_cloak_of_fear)\b
      - match: \b(ICON_confusion)\b
      - match: \b(ICON_contingency_active)\b
      - match: \b(ICON_courage)\b
      - match: \b(ICON_critical_strike)\b
      - match: \b(ICON_cursed)\b
      - match: \b(ICON_deaf)\b
      - match: \b(ICON_death_ward)\b
      - match: \b(ICON_deathblow)\b
      - match: \b(ICON_decaying)\b
      - match: \b(ICON_defensive_harmony)\b
      - match: \b(ICON_defensive_stance)\b
      - match: \b(ICON_detecting_traps)\b
      - match: \b(ICON_dialog_mode)\b
      - match: \b(ICON_dire_charm)\b
      - match: \b(ICON_domination)\b
      - match: \b(ICON_doom)\b
      - match: \b(ICON_draw_upon_holy_might)\b
      - match: \b(ICON_dying)\b
      - match: \b(ICON_earth_elemental_transformation)\b
      - match: \b(ICON_enchanted_weapon)\b
      - match: \b(ICON_energy_drain_mindflayer)\b
      - match: \b(ICON_energy_drain_psionic)\b
      - match: \b(ICON_enfeebled)\b
      - match: \b(ICON_enraged)\b
      - match: \b(ICON_entangled)\b
      - match: \b(ICON_ether_gate)\b
      - match: \b(ICON_evasion)\b
      - match: \b(ICON_exaltation)\b
      - match: \b(ICON_farsight)\b
      - match: \b(ICON_fatigue)\b
      - match: \b(ICON_feebleminded)\b
      - match: \b(ICON_fire_elemental_transformation)\b
      - match: \b(ICON_fire_shield_blue)\b
      - match: \b(ICON_fire_shield_red)\b
      - match: \b(ICON_free_action)\b
      - match: \b(ICON_friends)\b
      - match: \b(ICON_ghost_armor)\b
      - match: \b(ICON_glass_dust)\b
      - match: \b(ICON_glitterdust)\b
      - match: \b(ICON_globe_of_blades)\b
      - match: \b(ICON_globe_of_invulnerability)\b
      - match: \b(ICON_good_luck)\b
      - match: \b(ICON_grease)\b
      - match: \b(ICON_greater_deathblow)\b
      - match: \b(ICON_greater_evasion)\b
      - match: \b(ICON_greater_malison)\b
      - match: \b(ICON_greater_shield_of_lathander)\b
      - match: \b(ICON_greater_whirlwind)\b
      - match: \b(ICON_hardiness)\b
      - match: \b(ICON_haste)\b
      - match: \b(ICON_held)\b
      - match: \b(ICON_heroism)\b
      - match: \b(ICON_holy_power)\b
      - match: \b(ICON_hope)\b
      - match: \b(ICON_hopelessness)\b
      - match: \b(ICON_immunity_abjuration)\b
      - match: \b(ICON_immunity_alteration)\b
      - match: \b(ICON_immunity_conjuration)\b
      - match: \b(ICON_immunity_divination)\b
      - match: \b(ICON_immunity_enchantment)\b
      - match: \b(ICON_immunity_evocation)\b
      - match: \b(ICON_immunity_illusion)\b
      - match: \b(ICON_immunity_necromancy)\b
      - match: \b(ICON_impervious_sanctity_of_mind)\b
      - match: \b(ICON_imprisonment)\b
      - match: \b(ICON_improved_alacrity)\b
      - match: \b(ICON_improved_chaos_shield)\b
      - match: \b(ICON_improved_haste)\b
      - match: \b(ICON_improved_mantle)\b
      - match: \b(ICON_increased_movement_rate)\b
      - match: \b(ICON_infravision)\b
      - match: \b(ICON_intelligence_drained_by_mind_flayer)\b
      - match: \b(ICON_intoxicated)\b
      - match: \b(ICON_invulnerable)\b
      - match: \b(ICON_iron_body)\b
      - match: \b(ICON_iron_skins)\b
      - match: \b(ICON_kai)\b
      - match: \b(ICON_level_drain)\b
      - match: \b(ICON_magic_armour)\b
      - match: \b(ICON_magic_flute)\b
      - match: \b(ICON_magic_resistance)\b
      - match: \b(ICON_magic_resistance_lowered)\b
      - match: \b(ICON_magnetized)\b
      - match: \b(ICON_mantle)\b
      - match: \b(ICON_mareks_poison)\b
      - match: \b(ICON_master_thievery)\b
      - match: \b(ICON_maze)\b
      - match: \b(ICON_mental_combat)\b
      - match: \b(ICON_mind_blank)\b
      - match: \b(ICON_mind_shield)\b
      - match: \b(ICON_minor_globe_of_invulnerability)\b
      - match: \b(ICON_miscast_magic)\b
      - match: \b(ICON_mislead)\b
      - match: \b(ICON_nauseated)\b
      - match: \b(ICON_negative_plane_protection)\b
      - match: \b(ICON_offensive_stance)\b
      - match: \b(ICON_otilukes_resilient_sphere)\b
      - match: \b(ICON_pain)\b
      - match: \b(ICON_panic)\b
      - match: \b(ICON_perception)\b
      - match: \b(ICON_petrified)\b
      - match: \b(ICON_phased)\b
      - match: \b(ICON_physical_mirror)\b
      - match: \b(ICON_poisoned)\b
      - match: \b(ICON_polymorph_self)\b
      - match: \b(ICON_polymorphed)\b
      - match: \b(ICON_power_attack)\b
      - match: \b(ICON_prayer)\b
      - match: \b(ICON_projected_image)\b
      - match: \b(ICON_protected_from_energy)\b
      - match: \b(ICON_protected_from_the_elements)\b
      - match: \b(ICON_protection_from_acid)\b
      - match: \b(ICON_protection_from_cold)\b
      - match: \b(ICON_protection_from_electricity)\b
      - match: \b(ICON_protection_from_evil)\b
      - match: \b(ICON_protection_from_fire)\b
      - match: \b(ICON_protection_from_magic)\b
      - match: \b(ICON_protection_from_magic_weapons)\b
      - match: \b(ICON_protection_from_magical_energy)\b
      - match: \b(ICON_protection_from_missiles)\b
      - match: \b(ICON_protection_from_normal_weapons)\b
      - match: \b(ICON_protection_from_petrification)\b
      - match: \b(ICON_protection_from_poison)\b
      - match: \b(ICON_protection_from_undead)\b
      - match: \b(ICON_quivering_palm)\b
      - match: \b(ICON_recitation)\b
      - match: \b(ICON_regenerate)\b
      - match: \b(ICON_regenerating)\b
      - match: \b(ICON_regeneration)\b
      - match: \b(ICON_repulse_undead)\b
      - match: \b(ICON_repulsing_undead)\b
      - match: \b(ICON_repulsion)\b
      - match: \b(ICON_resist_fear)\b
      - match: \b(ICON_resist_fire_cold)\b
      - match: \b(ICON_righteous_magic)\b
      - match: \b(ICON_righteous_wrath_of_the_faithful)\b
      - match: \b(ICON_rigid_thinking)\b
      - match: \b(ICON_setting_trap)\b
      - match: \b(ICON_shamanic_dance)\b
      - match: \b(ICON_shield_of_lathander)\b
      - match: \b(ICON_shield_of_the_archons)\b
      - match: \b(ICON_shielded)\b
      - match: \b(ICON_silenced)\b
      - match: \b(ICON_sleep)\b
      - match: \b(ICON_slow)\b
      - match: \b(ICON_smite)\b
      - match: \b(ICON_spell_deflection)\b
      - match: \b(ICON_spell_failure)\b
      - match: \b(ICON_spell_immunity)\b
      - match: \b(ICON_spell_sequencer_active)\b
      - match: \b(ICON_spell_shield)\b
      - match: \b(ICON_spell_trap)\b
      - match: \b(ICON_spell_trigger)\b
      - match: \b(ICON_spell_turning)\b
      - match: \b(ICON_spirit_armour)\b
      - match: \b(ICON_spirit_ward)\b
      - match: \b(ICON_stoneskin)\b
      - match: \b(ICON_storm_shield)\b
      - match: \b(ICON_strength)\b
      - match: \b(ICON_strength_of_one)\b
      - match: \b(ICON_stun)\b
      - match: \b(ICON_stunning_blow)\b
      - match: \b(ICON_tensers_transformation)\b
      - match: \b(ICON_the_ballad_of_three_heroes)\b
      - match: \b(ICON_the_sirens_yearning)\b
      - match: \b(ICON_the_song_of_kaudies)\b
      - match: \b(ICON_the_tale_of_curran_strongheart)\b
      - match: \b(ICON_true_seeing)\b
      - match: \b(ICON_tymoras_melody)\b
      - match: \b(ICON_unconscious)\b
      - match: \b(ICON_vocalize)\b
      - match: \b(ICON_war_chant_of_sith)\b
      - match: \b(ICON_webbed)\b
      - match: \b(ICON_whirlwind_attack)\b
      - match: \b(NONMAGICAL)\b
      - match: \b(OPCODE_HLA_denotation)\b
      - match: \b(OPCODE_ac_vs_creature_type)\b
      - match: \b(OPCODE_ac_vs_damage_type)\b
      - match: \b(OPCODE_acid_resist_mod)\b
      - match: \b(OPCODE_add_map_marker)\b
      - match: \b(OPCODE_aid)\b
      - match: \b(OPCODE_alignment_change)\b
      - match: \b(OPCODE_alignment_invert)\b
      - match: \b(OPCODE_animation_change)\b
      - match: \b(OPCODE_animation_removal)\b
      - match: \b(OPCODE_apply_effect_item)\b
      - match: \b(OPCODE_apply_effect_itemtype)\b
      - match: \b(OPCODE_apply_repeating_eff)\b
      - match: \b(OPCODE_attack_nearest_creature)\b
      - match: \b(OPCODE_attack_speed_factor)\b
      - match: \b(OPCODE_attacks_per_round_mod)\b
      - match: \b(OPCODE_aura_cleansing)\b
      - match: \b(OPCODE_avatar_removal)\b
      - match: \b(OPCODE_backstab)\b
      - match: \b(OPCODE_backstab_every_hit)\b
      - match: \b(OPCODE_bless)\b
      - match: \b(OPCODE_blindness)\b
      - match: \b(OPCODE_bounce_opcode)\b
      - match: \b(OPCODE_bounce_projectile)\b
      - match: \b(OPCODE_bounce_school_decrement)\b
      - match: \b(OPCODE_bounce_secondary_type)\b
      - match: \b(OPCODE_bounce_secondary_type_decrement)\b
      - match: \b(OPCODE_bounce_specified_spell)\b
      - match: \b(OPCODE_bounce_spell_level)\b
      - match: \b(OPCODE_bounce_spell_school)\b
      - match: \b(OPCODE_button_disable_button)\b
      - match: \b(OPCODE_button_enable_button)\b
      - match: \b(OPCODE_can_use_any_item)\b
      - match: \b(OPCODE_cant_use_item)\b
      - match: \b(OPCODE_cant_use_itemtype)\b
      - match: \b(OPCODE_cast_spell_at_creature)\b
      - match: \b(OPCODE_cast_spell_at_point)\b
      - match: \b(OPCODE_cast_spell_on)\b
      - match: \b(OPCODE_casting_glow)\b
      - match: \b(OPCODE_casting_level_mod)\b
      - match: \b(OPCODE_casting_time_mod)\b
      - match: \b(OPCODE_change_bard_song)\b
      - match: \b(OPCODE_chaos_shield)\b
      - match: \b(OPCODE_character_animation_change)\b
      - match: \b(OPCODE_charisma_mod)\b
      - match: \b(OPCODE_charm_charm_specific_creature)\b
      - match: \b(OPCODE_charm_control_creature)\b
      - match: \b(OPCODE_check_for_berserk)\b
      - match: \b(OPCODE_clear_fog_of)\b
      - match: \b(OPCODE_cold_resist_mod)\b
      - match: \b(OPCODE_colour_change_by_rgb)\b
      - match: \b(OPCODE_colour_glow_by_rgb_brief)\b
      - match: \b(OPCODE_colour_glow_pulse)\b
      - match: \b(OPCODE_colour_set_character_colours_by)\b
      - match: \b(OPCODE_colour_strong_dark_by_rgb)\b
      - match: \b(OPCODE_colour_very_bright_by_rgb)\b
      - match: \b(OPCODE_confusion)\b
      - match: \b(OPCODE_constitution_mod)\b
      - match: \b(OPCODE_contingency_creation)\b
      - match: \b(OPCODE_create_inventory_item)\b
      - match: \b(OPCODE_create_inventory_item_days)\b
      - match: \b(OPCODE_create_item_in_slot)\b
      - match: \b(OPCODE_create_magical_weapon)\b
      - match: \b(OPCODE_creature_summoning)\b
      - match: \b(OPCODE_critical_hit_mod)\b
      - match: \b(OPCODE_crushing_resist_mod)\b
      - match: \b(OPCODE_cumulative_luck_bonus)\b
      - match: \b(OPCODE_cure_berserking)\b
      - match: \b(OPCODE_cure_blindness)\b
      - match: \b(OPCODE_cure_confusion)\b
      - match: \b(OPCODE_cure_deafness)\b
      - match: \b(OPCODE_cure_death)\b
      - match: \b(OPCODE_cure_disease)\b
      - match: \b(OPCODE_cure_dispellable_effects)\b
      - match: \b(OPCODE_cure_drunkeness)\b
      - match: \b(OPCODE_cure_feeblemindedness)\b
      - match: \b(OPCODE_cure_hold)\b
      - match: \b(OPCODE_cure_horror)\b
      - match: \b(OPCODE_cure_invisibility)\b
      - match: \b(OPCODE_cure_invisibility_2)\b
      - match: \b(OPCODE_cure_level_drain)\b
      - match: \b(OPCODE_cure_poison)\b
      - match: \b(OPCODE_cure_silence)\b
      - match: \b(OPCODE_cure_sleep)\b
      - match: \b(OPCODE_cure_stone_to_flesh)\b
      - match: \b(OPCODE_cure_stun)\b
      - match: \b(OPCODE_cure_unpause_target)\b
      - match: \b(OPCODE_damage_mod)\b
      - match: \b(OPCODE_damage_vs_creature)\b
      - match: \b(OPCODE_deafness)\b
      - match: \b(OPCODE_death_dependent_constitution)\b
      - match: \b(OPCODE_death_disintegrate)\b
      - match: \b(OPCODE_death_kill_60hp)\b
      - match: \b(OPCODE_death_kill_creature_type)\b
      - match: \b(OPCODE_decrementing_bounce_spells)\b
      - match: \b(OPCODE_decrementing_spell_immunity)\b
      - match: \b(OPCODE_defrost)\b
      - match: \b(OPCODE_detect_alignment)\b
      - match: \b(OPCODE_detect_illusion_mod)\b
      - match: \b(OPCODE_dexterity_mod)\b
      - match: \b(OPCODE_dimension_door)\b
      - match: \b(OPCODE_disable_permanent_death)\b
      - match: \b(OPCODE_disable_spell_casting_abilities)\b
      - match: \b(OPCODE_disable_visual_effect)\b
      - match: \b(OPCODE_disease)\b
      - match: \b(OPCODE_dispel_magic)\b
      - match: \b(OPCODE_display_special_effect_icon)\b
      - match: \b(OPCODE_dither)\b
      - match: \b(OPCODE_dont_jump)\b
      - match: \b(OPCODE_drain_item_charges)\b
      - match: \b(OPCODE_drain_wizard_spell)\b
      - match: \b(OPCODE_drop_weapons_in_panic)\b
      - match: \b(OPCODE_drunkenness_mod)\b
      - match: \b(OPCODE_duration_mod)\b
      - match: \b(OPCODE_effect_berserking)\b
      - match: \b(OPCODE_effect_wild_magic)\b
      - match: \b(OPCODE_electricity_resist_mod)\b
      - match: \b(OPCODE_empty)\b
      - match: \b(OPCODE_execute_script_cut250a)\b
      - match: \b(OPCODE_existance_delay_override)\b
      - match: \b(OPCODE_experience_points)\b
      - match: \b(OPCODE_extra_damage_mod)\b
      - match: \b(OPCODE_familiar_block)\b
      - match: \b(OPCODE_farsight)\b
      - match: \b(OPCODE_fatigue_mod)\b
      - match: \b(OPCODE_feeblemindedness)\b
      - match: \b(OPCODE_find_familiar)\b
      - match: \b(OPCODE_find_traps)\b
      - match: \b(OPCODE_find_traps_mod)\b
      - match: \b(OPCODE_fire_resist_mod)\b
      - match: \b(OPCODE_fist_damage_mod)\b
      - match: \b(OPCODE_fist_thac0_mod)\b
      - match: \b(OPCODE_force_visible)\b
      - match: \b(OPCODE_give_ability)\b
      - match: \b(OPCODE_gold)\b
      - match: \b(OPCODE_golem_stoneskin)\b
      - match: \b(OPCODE_haste)\b
      - match: \b(OPCODE_haste_2)\b
      - match: \b(OPCODE_hide_in_shadows_mod)\b
      - match: \b(OPCODE_hold)\b
      - match: \b(OPCODE_hold3)\b
      - match: \b(OPCODE_hold_2)\b
      - match: \b(OPCODE_horror)\b
      - match: \b(OPCODE_hp_current_hp_mod)\b
      - match: \b(OPCODE_hp_damage)\b
      - match: \b(OPCODE_hp_maximum_hp_mod)\b
      - match: \b(OPCODE_hp_minimum_limit)\b
      - match: \b(OPCODE_hp_regeneration)\b
      - match: \b(OPCODE_identify)\b
      - match: \b(OPCODE_ids_set_ids_state)\b
      - match: \b(OPCODE_ids_sex_change)\b
      - match: \b(OPCODE_ignore_dialog_pause)\b
      - match: \b(OPCODE_image_projection)\b
      - match: \b(OPCODE_immunity_school_decrement)\b
      - match: \b(OPCODE_immunity_secondary_type_decrement)\b
      - match: \b(OPCODE_immunity_to_turn)\b
      - match: \b(OPCODE_imprisonment)\b
      - match: \b(OPCODE_infravision)\b
      - match: \b(OPCODE_instant_death)\b
      - match: \b(OPCODE_intelligence_mod)\b
      - match: \b(OPCODE_invisibility)\b
      - match: \b(OPCODE_invisible_detection_by)\b
      - match: \b(OPCODE_knock)\b
      - match: \b(OPCODE_learn_spell)\b
      - match: \b(OPCODE_level_change)\b
      - match: \b(OPCODE_level_drain)\b
      - match: \b(OPCODE_lighting_effects)\b
      - match: \b(OPCODE_lore_mod)\b
      - match: \b(OPCODE_magic_damage_resist_mod)\b
      - match: \b(OPCODE_magic_resist_mod)\b
      - match: \b(OPCODE_magical_cold_resist_mod)\b
      - match: \b(OPCODE_magical_fire_resist_mod)\b
      - match: \b(OPCODE_magical_rest)\b
      - match: \b(OPCODE_mass_raise_dead)\b
      - match: \b(OPCODE_maze)\b
      - match: \b(OPCODE_melee_thac0_mod)\b
      - match: \b(OPCODE_melee_weapon_damage_mod)\b
      - match: \b(OPCODE_mirror_image)\b
      - match: \b(OPCODE_mirror_image_exact_number)\b
      - match: \b(OPCODE_miscast_magic)\b
      - match: \b(OPCODE_missile_weapon_damage_mod)\b
      - match: \b(OPCODE_missiles_resist_mod)\b
      - match: \b(OPCODE_monster_summoning)\b
      - match: \b(OPCODE_morale_break_mod)\b
      - match: \b(OPCODE_morale_mod)\b
      - match: \b(OPCODE_movement_mod)\b
      - match: \b(OPCODE_movement_mod_2)\b
      - match: \b(OPCODE_negative_chant)\b
      - match: \b(OPCODE_npcbump)\b
      - match: \b(OPCODE_open_locks_mod)\b
      - match: \b(OPCODE_overlay_blur)\b
      - match: \b(OPCODE_overlay_entangle)\b
      - match: \b(OPCODE_overlay_grease)\b
      - match: \b(OPCODE_overlay_minor_globe)\b
      - match: \b(OPCODE_overlay_protection_from_normal_missiles)\b
      - match: \b(OPCODE_overlay_sanctuary)\b
      - match: \b(OPCODE_passwall)\b
      - match: \b(OPCODE_pause_target)\b
      - match: \b(OPCODE_petrification)\b
      - match: \b(OPCODE_pick_pockets_mod)\b
      - match: \b(OPCODE_piercing_resist_mod)\b
      - match: \b(OPCODE_play_3d_effect)\b
      - match: \b(OPCODE_play_damage_animation)\b
      - match: \b(OPCODE_play_movie)\b
      - match: \b(OPCODE_play_sound_effect)\b
      - match: \b(OPCODE_poison)\b
      - match: \b(OPCODE_poison_resist_mod)\b
      - match: \b(OPCODE_polymorph_into_specific)\b
      - match: \b(OPCODE_portrait_change)\b
      - match: \b(OPCODE_positive_chant)\b
      - match: \b(OPCODE_prevent_special_effect_icon)\b
      - match: \b(OPCODE_priest_spell_slots_mod)\b
      - match: \b(OPCODE_proficiency_mod)\b
      - match: \b(OPCODE_protection_backstab)\b
      - match: \b(OPCODE_protection_free_action)\b
      - match: \b(OPCODE_protection_freedom)\b
      - match: \b(OPCODE_protection_from_creature_type)\b
      - match: \b(OPCODE_protection_from_detection)\b
      - match: \b(OPCODE_protection_from_display_specific_string)\b
      - match: \b(OPCODE_protection_from_melee_weapons)\b
      - match: \b(OPCODE_protection_from_opcode)\b
      - match: \b(OPCODE_protection_from_projectile)\b
      - match: \b(OPCODE_protection_from_specific_animation)\b
      - match: \b(OPCODE_protection_from_spell)\b
      - match: \b(OPCODE_protection_from_spell_levels)\b
      - match: \b(OPCODE_protection_from_spell_school)\b
      - match: \b(OPCODE_protection_from_spell_secondary_type)\b
      - match: \b(OPCODE_protection_from_timestop)\b
      - match: \b(OPCODE_protection_from_tracking)\b
      - match: \b(OPCODE_protection_spell_trap)\b
      - match: \b(OPCODE_protection_stoneskin)\b
      - match: \b(OPCODE_puppet_id)\b
      - match: \b(OPCODE_raise_dead)\b
      - match: \b(OPCODE_random_wish_spell)\b
      - match: \b(OPCODE_ranger_tracking_ability)\b
      - match: \b(OPCODE_removal_remove_one_school)\b
      - match: \b(OPCODE_removal_remove_one_secondary_type)\b
      - match: \b(OPCODE_removal_remove_school)\b
      - match: \b(OPCODE_removal_remove_secondary_type)\b
      - match: \b(OPCODE_remove_creature)\b
      - match: \b(OPCODE_remove_curse)\b
      - match: \b(OPCODE_remove_infravision)\b
      - match: \b(OPCODE_remove_inventory_item)\b
      - match: \b(OPCODE_remove_item)\b
      - match: \b(OPCODE_remove_map_marker)\b
      - match: \b(OPCODE_remove_protection_from_spell)\b
      - match: \b(OPCODE_remove_sanctuary)\b
      - match: \b(OPCODE_remove_special_effect_icon)\b
      - match: \b(OPCODE_remove_specific_area_effect)\b
      - match: \b(OPCODE_remove_spell)\b
      - match: \b(OPCODE_replace_creature)\b
      - match: \b(OPCODE_reputation)\b
      - match: \b(OPCODE_restoration)\b
      - match: \b(OPCODE_restore_lost_spells)\b
      - match: \b(OPCODE_reveal_area)\b
      - match: \b(OPCODE_reveal_magic)\b
      - match: \b(OPCODE_save_vs_breath_weapons)\b
      - match: \b(OPCODE_save_vs_death_mod)\b
      - match: \b(OPCODE_save_vs_petrification)\b
      - match: \b(OPCODE_save_vs_polymorph_mod)\b
      - match: \b(OPCODE_save_vs_spells_mod)\b
      - match: \b(OPCODE_save_vs_wands_mod)\b
      - match: \b(OPCODE_script_enable_offscreen_ai)\b
      - match: \b(OPCODE_script_modify_global_variable)\b
      - match: \b(OPCODE_script_modify_local_variable)\b
      - match: \b(OPCODE_script_movetoarea)\b
      - match: \b(OPCODE_script_scripting_state_mod)\b
      - match: \b(OPCODE_script_store_local_variable)\b
      - match: \b(OPCODE_select_spell)\b
      - match: \b(OPCODE_selection_circle_removal)\b
      - match: \b(OPCODE_set_ai_script)\b
      - match: \b(OPCODE_set_melee_effect)\b
      - match: \b(OPCODE_set_ranged_effect)\b
      - match: \b(OPCODE_set_stat_tobex)\b
      - match: \b(OPCODE_set_trap)\b
      - match: \b(OPCODE_set_traps_mod)\b
      - match: \b(OPCODE_shake_window)\b
      - match: \b(OPCODE_silence)\b
      - match: \b(OPCODE_slashing_resist_mod)\b
      - match: \b(OPCODE_slow)\b
      - match: \b(OPCODE_sparkle)\b
      - match: \b(OPCODE_spell_sequencer_activation)\b
      - match: \b(OPCODE_spell_sequencer_active)\b
      - match: \b(OPCODE_spell_sequencer_creation)\b
      - match: \b(OPCODE_stat_wild_magic_mod)\b
      - match: \b(OPCODE_state_berserking)\b
      - match: \b(OPCODE_stealth_mod)\b
      - match: \b(OPCODE_strength_mod)\b
      - match: \b(OPCODE_stun)\b
      - match: \b(OPCODE_stun_90hp)\b
      - match: \b(OPCODE_teleport)\b
      - match: \b(OPCODE_teleport_field)\b
      - match: \b(OPCODE_teleport_to_target)\b
      - match: \b(OPCODE_text_change_name)\b
      - match: \b(OPCODE_text_change_title)\b
      - match: \b(OPCODE_text_display_string)\b
      - match: \b(OPCODE_thac0_mod)\b
      - match: \b(OPCODE_thac0_mod_with_missile)\b
      - match: \b(OPCODE_thac0_vs_creature)\b
      - match: \b(OPCODE_time_stop)\b
      - match: \b(OPCODE_to_hit_mod)\b
      - match: \b(OPCODE_tracking_skill_mod)\b
      - match: \b(OPCODE_transparency_fade)\b
      - match: \b(OPCODE_unconsciousness)\b
      - match: \b(OPCODE_unconsciousness_20hp)\b
      - match: \b(OPCODE_unlock)\b
      - match: \b(OPCODE_unstun)\b
      - match: \b(OPCODE_unsummon_creature)\b
      - match: \b(OPCODE_use_eff_file)\b
      - match: \b(OPCODE_use_eff_file_cursed)\b
      - match: \b(OPCODE_visual_range)\b
      - match: \b(OPCODE_vocalize)\b
      - match: \b(OPCODE_web_effect)\b
      - match: \b(OPCODE_wing_buffet)\b
      - match: \b(OPCODE_wisdom_mod)\b
      - match: \b(OPCODE_wizard_spell_slots_mod)\b
      - match: \b(OPCODE_zone_of_sweet_air)\b
      - match: \b(SAVINGTHROW_BREATH)\b
      - match: \b(SAVINGTHROW_DEATH)\b
      - match: \b(SAVINGTHROW_POLYMORPH)\b
      - match: \b(SAVINGTHROW_SPELL)\b
      - match: \b(SAVINGTHROW_WAND)\b
      - match: \b(TARGET_eff_everyone)\b
      - match: \b(TARGET_eff_everyone_except_party)\b
      - match: \b(TARGET_eff_everyone_except_self)\b
      - match: \b(TARGET_eff_everyone_match_specific_caster)\b
      - match: \b(TARGET_eff_everyone_match_specific_target)\b
      - match: \b(TARGET_eff_none)\b
      - match: \b(TARGET_eff_original_caster)\b
      - match: \b(TARGET_eff_party)\b
      - match: \b(TARGET_eff_preset)\b
      - match: \b(TARGET_eff_self)\b
      - match: \b(TIMING_absolute_duration)\b
      - match: \b(TIMING_delayed)\b
      - match: \b(TIMING_delayed_duration)\b
      - match: \b(TIMING_duration)\b
      - match: \b(TIMING_permanent)\b
      - match: \b(TIMING_permanent_after_death)\b
      - match: \b(TIMING_trigger)\b
      - match: \b(TIMING_while_equipped)\b
